# 红黑树

接触红黑树前，需要看一下与其等价的2-3树，这样理解更深。2-3树中有两类结点，2结点和3结点，满足二分搜索树的基本性质

![](https://raw.githubusercontent.com/LibertyDream/diy_img_host/master/img/2019-10-13_23_tree.png)

同时，2-3树是绝对平衡的树，即从根结点到任意叶子结点的路径高度都是一样的。

![](https://raw.githubusercontent.com/LibertyDream/diy_img_host/master/img/2019-10-13_23_tree_eg.png)

2-3树的绝对平衡性和其插入操作的特点息息相关。2-3树的插入要保证永远不向空结点插入，即如果待插入位置为空，则先和已有结点融合，如果形成了4结点那么再分裂成若干2结点。具体的，分两类情况：

* 插入2结点

![](https://raw.githubusercontent.com/LibertyDream/diy_img_host/master/img/2019-10-13_insert_2_null.png)

- 插入3结点

3结点为根结点

![](https://raw.githubusercontent.com/LibertyDream/diy_img_host/master/img/2019-10-13_insert_3_null.png)

3结点为叶子结点，父结点为2结点

![](https://raw.githubusercontent.com/LibertyDream/diy_img_host/master/img/2019-10-13_insert_3_leaf.png)

3结点为叶子结点，父结点为3结点

![](https://raw.githubusercontent.com/LibertyDream/diy_img_host/master/img/2019-10-13_insert_3_root.png)

红黑树是2-3树的等价变换，因为红黑树每个结点只能存一个值，即都是2结点，所以就要用一种方法代替3结点。方法就是将3结点内的较小值视为较大值的左子树，同时将较小值标红，以示其和父结点“实为一体”。正因如此，红黑树中所有红色结点一定都是向左倾斜的。

![](https://raw.githubusercontent.com/LibertyDream/diy_img_host/master/img/2019-10-13_rb_node.png)

![](https://raw.githubusercontent.com/LibertyDream/diy_img_host/master/img/2019-10-13_rb_tree.png)



这时再看一下《算法导论》等著作谈及红黑树一开篇就会给出的五个性质：

- 每个结点或者是红色的，或者是黑色的——定义

- 根结点是黑色的

对应到2-3树，2结点在红黑树中是黑色的，3结点要拆分成黑连红，黑高红低的形式，所以根总是黑的

- 每一个叶子结点（最后的空节点）是黑色的

红黑树是有空结点的（左右子树为空），而只有3结点才会产生红结点，同时因为空结点的存在红结点不可能是路径终点，所以所有叶子结点都是黑色的

- 如果一个节点是红色的，那么他的孩子结点都是黑色的

还是因为3结点在红黑树中的映射方式，黑高红低，优先连到的总是黑结点，所以对于红结点其孩子结点必然都是黑的

- **从任意一个节点到叶子节点，经过的黑色节点是一样的**

这一条是红黑树的灵魂。因为插入特性使然，2-3树保持了绝对平衡性，所有叶子结点都在同一层，从任意结点开始到达其所能接触到的所有叶子结点的路径长度总是一致的

转换成红黑树时，3结点变成了黑高红低的形式，2结点不变，也就是说每经过一个黑结点相当于经过了2-3树中的一个结点。走过的黑结点串起来就是2-3树中的路径，所以从任一结点到叶子结点，经过的黑色结点必然相同

### 小结

从红黑树的性质可以看出，红黑树实质上是”黑平衡“，对黑色结点保持绝对平衡，而因为红色结点存在红黑树整体不一定满足平衡二叉树的条件，左右子树高度可能会大于1。

因此，极端情况下，红黑树的高度是 2logn，所以其查询效率会比 AVL 树低一些，但是”黑平衡“的存在使得红黑树在插入和删除操作上的效率总是 logn ，优于 AVL

总的来说，红黑树统计性能最优（增删改查都算上），AVL 树适于应付查询频繁的场景，当数据完全随机时简单的二分搜索树性能同样优秀。

### 注意

上文讲解红黑树时采取的是”左倾“红黑树，实际上右倾同样满足红黑树的性质，因为性质四只声明红结点的孩子必然是黑的，可没说方向，所以可以叫性质4为”红性质“，性质5为“黑性质”。

当不局限左倾和右倾时，红黑树具有一个十分优异的性能——**任何不平衡都能在三次旋转内解决**